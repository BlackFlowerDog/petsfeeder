# petsfeeder
Простой web-интерфейс системы умных кормушек для кошек и соба
## Небольшое описание, что это
Учебный проект. Для серверной части была использована связка Python + Flask во избежание постоянной загрузки файлов на плату и замедления редактирования. Интерфейс может быть использован для реальной системы умных кормушек. ***Текущая серверная часть не предназначена для загрузки на плату, а нужна только для более удобной отладки.***

Краткий список функций:

    1. Кнопка ручного наполнения миски
    2. Отображение данных с датчиков уровня корма
    3. Хранение информации о питомцах
    4. Настройка расписания кормления
    5. Отсчет времени до следующего кормления
    
## Подробное описание функционала, скриншоты страниц
### Pages
Страниц всего четыре: одна с основной информацией (данные питомцев, расписание, время до следующего кормления, уровень корма), две для редактирования расписаний и списка питомцев и еще одна с данными о команде разработки.

В хедере каждой страницы расположено меню.

![menu](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/menu.png)

#### MAIN

Данные о питомцах отображены в карточках-таблицах.
| № | field name     |
|-----:|-----------|
| 1 | pet name |
| 2 | type (cat or dog) |
| 3 | sex (male or female) |
| 4 | birthday (если была указана) |
| 5 | years old (высчитывается на странице на основе даты рождения и текущей даты в системе) | 
| 6 | Активирована/неактивирована функция кормления по времени |

Под основной информацией находится фотография питомца. Если фотография не была загружена при добавлении питомца, будут использована default-cat или default-dog - в зависимости от указанного типа животного. Для переключения между питомцами нужно использовать стрелки, расположенные по обе сторны от карточки. Крест в левом верхнем углу удаляет текущего питомца (появляется только на странице add pet).

![pet card](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/pet_card.png)

При наведении курсора на черную иконку расписания справа снизу выпадет используемое время кормления, но только при условии, что кормление по времени активировано. Даже если у питомца имеется сохраненное расписание, оно не будет отображаться.

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/time_PC.png)

Если нет сохранных питомцев, то будет отображен шаблон карточки.

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/image.png)

Справа находится измеритель, отображающий данные с датчиков уровня корма в миске. Когда стрелка направлена на красный сектор, его цвет меняется с бледного на более насыщенный красный.

Под измерителем - таймер, отсчитывающий время до следующего кормления (работает, если расписание активировано). 
Под таймером кнопка ручного наполения миски. 

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/foodlvl.png)

#### ADD PETS

Слева расположен блок с уже существующими питомцами. Справа от него форма для ввода данных о новом питомце. Обязательные поля: имя, пол и тип (кошка/собака) животного. Имя можеть иметь длину не более 10 символов.
Для добавления питомца необходимо нажать расположенную справа внизу иконку галки.
Так же с этой страницы доступно удаление питомца.

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/addPet.png)

При загрузке фотографии отобразятся ее миниатюра, размер и название.

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/uploads_image.png)

Если не загружать свою фотографию на сервер, то в качесте фотографии питомца будут использованы дефолтные кошка и собака.

![Image alt](https://github.com/BlackFlowerDog/petsfeeder/raw/main/static/images/default-cat.jpg)

![Image alt](https://github.com/BlackFlowerDog/petsfeeder/raw/main/static/images/default-dog.jpg)

#### EDIT SCHEDULES

Слева карточка питомца, расписание которого отображается. При переключении между питомцами с помощью стрелок соответственно будет меняться расписание. Оно отображается вне зависимости от того, активирована ли функция кормления по установленному времени или нет.

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/schedule_editor.png)

Можно:
    - Активировать или деактивировать кормление по времени. При деактивации используемое раписание сохраняется;
    - Полностью сбросить расписание;
    - Удалить конкретное время из расписания (крест напротив записи в таблице);
    - Добавить новое время кормления в расписание.

Если у питомца нет сохраненного времени, будет выведен шаблон.

![Image ](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/image.png)

#### ABOUT US

 Можно использовать для заполнения инфомарции о команде создателей.

![Image alt](https://github.com/BlackFlowerDog/laughing-bassoon/raw/main/about_us.png)

### config.json

 Все данные о животных хранит файл config.json, используемый в качестве аналога небольшой базы данных. 
 Пример записи об одном питомце.

```
{ 
  "Cocca": 
  {
    "type": true,
    "photoName": "Cocca201c72b1-aa26-4a61-a765-ded2347e65c3.jpg",
    "birthday": "",
    "sex": true,
    "schedule": 
      {
        "activate": false,
        "time": ["12:12"]
      }
  }
}
```

Все питомцы хранятся как записи в словаре. Ключом является имя животного, соответственно добавление нескольких питомцев с одинаковыми именами невозможно.
Type - cat (true), dog (false). Sex - male (true), female (false).

К началу названия загруженной фотографии добавляется имя питомца для создания уникального названия для фотографии во избежание ее ошибочного удаления, если пользователь загрузит две фотографии с одинаковым названием.

Activate - отвечает за активацию расписания кормления. Time - массив со временем кормления, отсортированным по возрастанию.

### Формат данных, передающихся с сервера

Все данные сервер отправляет в формате JSON.

1. Данные с датчиков уровня корма получаются по адресу /api/get_pet_food_level. Отправляются в виде JSON словаря, где ключом является имя питомца, значением - процент заполнения миски.

```
{
  "Cocca": 2,
  "Tim": 3
}
```
 2. Данные обо всех питомцах для отрисовки карточек и расписания отправляются по адресу /api/get_pets. Это считанный JSON-словарь из config.json.
 3. Для работы таймера осуществляется отправка всех расписаний питомцев по адресу /api/get_schedule в формате словаря JSON, где ключом является имя животного, значением - поля schedule 

```
{
   "Cocca": 
    { 
      "activate": true,
      "time": ["12:12, "15:10"]
    },
    "Tim": 
    {
      "activate": false,
      "time": []
    }
}
```
  4. После внесения изменений в расписание необходимо заново отрисовать на странице новую информацию. Расписание для одного питомца отправляется по адресу /api/get_schedule/<petName>, где <petName> - имя питомца текущей карточки. Будет отправлена просто schedule.
 
```
  { 
      "activate": true,
      "time": ["12:12", "15:10"]
  }
```

### Формат данных, отправляемых на сервер
  
1. Добаление питомца
  
Данные отправляются POST-запросом. Доступны по именам: имя питомца - name, тип - type (принимает значения либо cat, либо dog, на сервер сохранятся true/falsе         соответственно), фотография - photo, пол - gender (принимает значения либо male, либо female, на сервер сохранятся true/falsе соответственно), активация кормления по    времени - isSchedule (принимает значения либо on, либо off, на сервер сохранятся true/falsе соответственно).
  
2. Удаление питомца
  
GET-запрос, удаление осуществляется по имени. 
 
Строка запроса: /delete_pet?delete_pet=${CURRENT_NAME}.
 
Название нужного аргумента - delete_petПри удалении не должны удалятся фотографии с названиями default-cat.jpg и default-dog.jpg.

3. Редактирование schedule: сброс расписания, добавление времени, удаление времени, активация использования расписания
  
Все четыре действия обрабатываются по адресу /settings/schedule и являются GET-запросами.

Первым аргументом в запросе будет стоять наименование выполняемого действия (delete_time, change_activate, add_time, reset_schedul), можно получить по имени action, вторым - имя питомца, можно получить по имени pet_name. При удалении или добавлении времени появляетс третий аргумент - добавляемое или удаляемое время, который можно получить по имени time.
  
Примеры запросов
  
```
  /settings/schedule?action=delete_time&pet_name=Cocca&time=12:12
  /settings/schedule?action=change_activation&pet_name=Cocca
  /settings/schedule?action=add_time&pet_name=Cocca&time=15:10
  /settings/schedule?action=reset_schedule&pet_name=Cocca
```
4. Наполнение миски
Используется функция-заглушка, с сервера отправляющая ответ, о том, что миска пополнена.
